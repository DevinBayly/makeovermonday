---
theme: dashboard
title: 2025 w-18
toc: false
---



```js
let dlData = FileAttachment("data/2025-w18.csv").csv({typed:true})
console.log(dlData)

// modify 
```


```js
let dlDataTable = aq.from(dlData)
// get the net values
let netNeg = dlDataTable.getter("Net Disapprove")(0)
console.log(netNeg)
// split off the nets because we don't want them as bars
let nonNetData = dlDataTable.select(aq.not("Net Approve","Net Disapprove"))
let netData = dlDataTable.select("Net Approve","Net Disapprove","Demographic")

let foldedNonNetData = nonNetData.fold(
    ["Very Strongly Disapprove","Not Strongly Disapprove","Not Strongly Approve","Very Strongly Approve"],
    {"as":["opinion","count"]}
)
let foldedNetData = netData.fold(
  ["Net Approve","Net Disapprove"],
  {
    "as":["opinion","count"]
  }
)
// groups with more dissatisfaction
let onlyDisapproves = dlData.filter((e,i) => {
    let scores = []
    let entries = Object.entries(e)
    // result is
    for (let entry of entries) {
      let [k,val] = entry
      if (/Net/.test(k)) {
        scores.push([k,val])
      }
    }
    console.log(scores)
    if (scores[0][1] > scores[1][1]) {
    return true
    }
}).map(e=>e.Demographic)

// cant' figure out how to get a full first row without going back to objects array
```
```js
let barplot = Plot.plot({
    x: { tickFormat: Math.abs, label: "% responses" },
    color: { domain: order, range:["#8f855a","#c1ba9e","#e3ca82","#d2a92e"] ,legend:true},
    marginLeft:150,
    marks:[
        Plot.barX(foldedNonNetData,{"x":"count","y":"Demographic","fill":"opinion",sort:{
          y:"-x",
          reduce:"first"
        }})
    ]
})
```

```js

// credit to observablehq/plot-diverging-stacked-bar
function Likert(responses) {
  const map = new Map(responses);
  return {
    order: Array.from(map.keys()),
    offset(I, X1, X2, Z) {
     for (const stacks of I) {
        // one set of 6 elements,  indices
        for (const stack of stacks) {
          // for each elelement in the 6
          // the map.get(Z[i]) becomes a number in the -1,0,1 range
          // X2[i] - x1[i] is the length of the bar
          const k = d3.sum(stack, (i) => (X2[i] - X1[i]) * (1 - map.get(Z[i]))) / 2;
          for (const i of stack) {
            X1[i] -= k;
            X2[i] -= k;
          }
        }
      }
    }
  };
}
const {order,offset} = Likert([
["Very Strongly Disapprove",-1],
["Not Strongly Disapprove",-1],
["Not Strongly Approve",1],
["Very Strongly Approve",1],
])
console.log(order)
let dy = (I,x1,x2,Z) => {
  //console.log(I)
  return 0
}
let sort_reduce = (i,e,extent)=> {
  //console.log("reducing",i,e,extent)
  return i[3]
}

let hisConstituents = Plot.plot({
    x: { tickFormat: Math.abs, label: "% responses" },
    y: { 
      tickSize: 0,
     },
     
    color: { domain: order, range:["#8f855a","#c1ba9e","#e3ca82","#d2a92e"] ,legend:true},
    insetLeft:50,
    marginLeft:150,
    marks: [
      Plot.barX(
        foldedNonNetData,
        {
            "x":"count",
            "fill":"opinion",
            "fy":"Demographic",
            sort:{
              fy:"x",
              reduce:sort_reduce,
            },
            order,
            offset
        }
      )
    ]
})
let basic = Plot.plot({
    x: { tickFormat: Math.abs, label: "% responses" },
    y: { 
      tickSize: 0,
     },
     
    color: { domain: order, range:["#8f855a","#c1ba9e","#e3ca82","#d2a92e"] ,legend:true},
    insetLeft:50,
    marginLeft:150,
    marks: [
      Plot.barX(
        foldedNonNetData,
        {
            "x":"count",
            "fill":"opinion",
            "fy":"Demographic",
            order,
            offset
        }
      )
    ]
})

//backgroundSVG.node().append(hisConstituents.childNodes.item(1))
```
<h1>
Make over monday dataset 2025-w18
</h1>
<div class="grid grid-cols-4">
<div class="card">
<h2>Net Disapproval for Trump has reached 
<h1>${netNeg}%</h1>
</h2>
<h2>List of groups who majority disapprove 
<h2 style="font-weight:bold">${onlyDisapproves.join(", ")}</h2>
</h2>

</div>
<div class="card">
  <h2>Totals across demographics 
  <h1>${Plot.plot({
    x: { tickFormat: Math.abs, label: "% responses" },
    color: { domain: ["Net Disapprove","Net Approve"], range:["#8f855a","#d2a92e"] ,legend:true},
    marginLeft:150,
    marks:[
        Plot.barX(foldedNetData,{"x":"count","y":"Demographic","fill":"opinion",sort:{
          y:"x",
          reduce:"first"
        }})
    ]})}

  </h2>
</div>
<div class="card grid-colspan-1 grid-rowspan-1">
${barplot}
</div>
</div>



</div>
<div class="grid grid-cols-2">

  <div class="card grid-colspan-1 grid-rowspan-1">
    ${basic}
  </div>
  <div class="card grid-colspan-1 grid-rowspan-1">
    <h2> Differences in approval by demographic</h2>
    <h3> Percentage of approval within 23 separate demographic groups</h3>
    ${hisConstituents}
  </div>
</div>

<div class="card">
${Inputs.table(dlData)}
</div>
<div class="card">
${Inputs.table(foldedNonNetData)}
</div>