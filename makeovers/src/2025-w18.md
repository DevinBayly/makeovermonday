---
theme: dashboard
title: 2025 w-18
toc: false
---



```js
let dlData = FileAttachment("data/2025-w18.csv").csv()
console.log(dlData)
// modify 
```

```js
let data = aq.from(dlData).fold(
    ["Very Strongly Disapprove","Not Strongly Disapprove","Net Disapprove","Not Strongly Approve","Very Strongly Approve","Net Approve"],
    {"as":["opinion","count"]}
)
```

```js
let barplot = Plot.plot({
    color: { legend: true},
    marks:[
        Plot.barX(data,{"x":"count","y":"Demographic","fill":"opinion"})
    ]
})
```

```js

// credit to observablehq/plot-diverging-stacked-bar
function Likert(responses) {
  console.log(responses)
  const map = new Map(responses);
  return {
    order: Array.from(map.keys()),
    offset(I, X1, X2, Z) {
      for (const stacks of I) {
        for (const stack of stacks) {
          const k = d3.sum(stack, (i) => (X2[i] - X1[i]) * (1 - map.get(Z[i]))) / 2;
          for (const i of stack) {
            X1[i] -= k;
            X2[i] -= k;
          }
        }
      }
    }
  };
}
const {order,offset} = Likert([
["Very Strongly Disapprove",-1],
["Not Strongly Disapprove",-1],
["Net Disapprove"-1],
["Not Strongly Approve",1],
["Very Strongly Approve",1],
["Net Approve",1],
])


let bar2 = Plot.plot({
    x: { tickFormat: Math.abs, label: "# of answers" },
    y: { tickSize: 0 },
    facet: { data: data, y: "Demographic" },
    color: { domain: order, scheme: "RdBu" },
    insetLeft:50,
    marginLeft:150,
    marks: [
      Plot.barX(
        data,
        {
            "x":"count",
            "fill":"opinion",
            order,
            offset
        }
      )
    ]
})
        
```

<div class="card">
${Inputs.table(dlData)}
</div>
<div class="card">
${barplot}
</div>
<div class="card">
${bar2}
</div>
<div class="card">
${Inputs.table(data)}
</div>