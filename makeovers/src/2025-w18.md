---
theme: dashboard
title: 2025 w-18
toc: false
---



```js
let dlData = FileAttachment("data/2025-w18.csv").csv()
console.log(dlData)

// modify 
```

```js
console.log(dlData.map(e=> e.Demographic))
```

```js
let dlDataTable = aq.from(dlData)
// split off the nets because we don't want them as bars
let nonNetData = dlDataTable.select(aq.not("Net Approve","Net Disapprove"))
let netData = dlDataTable.select("Net Approve","Net Disapprove")

let foldedNonNetData = nonNetData.fold(
    ["Very Strongly Disapprove","Not Strongly Disapprove","Not Strongly Approve","Very Strongly Approve"],
    {"as":["opinion","count"]}
)
let foldedNetData = netData.fold(
  ["Net Approve","Net Disapprove"],
  {
    "as":["opinion","count"]
  }
)
```

```js
let barplot = Plot.plot({
    color: { legend: true},
    marks:[
        Plot.barX(foldedNonNetData,{"x":"count","y":"Demographic","fill":"opinion"})
    ]
})
```

```js

// credit to observablehq/plot-diverging-stacked-bar
function Likert(responses) {
  const map = new Map(responses);
  return {
    order: Array.from(map.keys()),
    offset(I, X1, X2, Z) {
     for (const stacks of I) {
        // one set of 6 elements,  indices
        for (const stack of stacks) {
          // for each elelement in the 6
          // the map.get(Z[i]) becomes a number in the -1,0,1 range
          // X2[i] - x1[i] is the length of the bar
          const k = d3.sum(stack, (i) => (X2[i] - X1[i]) * (1 - map.get(Z[i]))) / 2;
          for (const i of stack) {
            X1[i] -= k;
            X2[i] -= k;
          }
        }
      }
    }
  };
}
const {order,offset} = Likert([
["Very Strongly Disapprove",-1],
["Not Strongly Disapprove",-1],
["Not Strongly Approve",1],
["Very Strongly Approve",1],
])
let dy = (I,x1,x2,Z) => {
  console.log(I)
  return 0
}
let sort_reduce = (i,e)=> {
  console.log("reducing",i,e)
}

let hisConstituents = Plot.plot({
    x: { tickFormat: Math.abs, label: "% responses" },
    y: { 
      tickSize: 0,
     },
     
    color: { domain: order, scheme: "RdBu" ,legend:true},
    insetLeft:50,
    marginLeft:150,
    marks: [
      Plot.barX(
        foldedNonNetData,
        {
            "x":"count",
            "fill":"opinion",
            "fy":"Demographic",
            sort:{
              fy:"-x",
              reduce:"last",
            },
            order,
            offset
        }
      )
    ]
})
        
```

<div class="card">
${Inputs.table(dlData)}
</div>

<div class="card">
${barplot}
</div>

<div class="card">
${hisConstituents}
</div>
<div class="card">
${Inputs.table(foldedNonNetData)}
</div>